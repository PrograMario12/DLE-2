{# stations_dashboards.html #} {% extends "base/base_dashboards.html" %} {%
block title %}Dashboard Estaciones - {{ line }}{% endblock %} {% block styles
%}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard_styles.css') }}"
/>
<!-- Iconos de Flaticon -->
<link
  rel="stylesheet"
  href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css"
/>
<link
  rel="stylesheet"
  href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css"
/>
{% endblock %} {% block header %}
<h1>
  <a
    href="javascript:history.back()"
    style="text-decoration: none; color: inherit; margin-right: 0.5rem"
    title="Volver"
    >←</a
  >
  {{ line }}
</h1>
<script src="{{ url_for('static', filename='js/modal.js') }}"></script>
{% endblock %} {% block content %}
<div class="content-wrapper">
  <!-- Loading Screen -->
  <div class="loading-screen">
    <div class="loading-spinner"></div>
  </div>

  <!-- Summary Section -->
  {% if totals %}
  <div class="operators-summary">
    <div class="summary-item">
      <i class="fi fi-rr-user"></i> Necesarios:
      <strong>{{ totals.capacity }}</strong>
    </div>
    <div class="summary-item">
      <i class="fi fi-sr-user"></i> Activos:
      <strong>{{ totals.active }}</strong>
    </div>

    <div class="progress-container">
      <div class="progress-bar" style="width: {{ totals.pct_active }}%;"></div>
      {% if totals.overflow_pct > 0 %}
      <div
        class="progress-bar"
        style="width: {{ totals.overflow_pct }}%; background-color: var(--status-red); position: absolute; top:0; left: 100%;"
      ></div>
      {% endif %}
    </div>

    <div class="summary-item">
      <strong>{{ totals.pct_active }}%</strong>
    </div>
  </div>
  {% endif %}

  <!-- Main Stations Grid -->
  <div class="station-grid">
    {% for card in cards_main %}
    <div class="station-card {% if card.status == false %} hidden {% endif %}">
      <div class="station-header">{{ tipo }} {{ card.position_name }}</div>

      <div class="sides-container">
        {% for side in card.sides %}
        <!-- Using side.class if available, or calculating it (but route usually provides it) -->
        <!-- The route actually provides 'class' on specific sidedict? Route logic puts class on SIDE dict? 
                   Lets check routes. Yes, side_status_class is called and assigned to side['class'].
              -->
        <div
          class="side-card {{ side.class }}"
          onclick="openModal({{ side.side_id or side.id }})"
        >
          <h3>{{ side.side_title }}</h3>
          <p>
            <i class="fi fi-rr-user"></i> {{ side.employee_capacity }}
            <span>/</span>
            {{ side.employees_working }} <i class="fi fi-sr-user"></i>
          </p>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>

  {% if has_afe %}
  <h2
    style="
      margin-top: 3rem;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      border-bottom: 2px solid #e2e8f0;
    "
  >
    Estaciones AFE
  </h2>
  <div class="station-grid">
    {% for card in cards_afe %}
    <div class="station-card {% if card.status == false %} hidden {% endif %}">
      <div class="station-header">{{ card.position_name }}</div>
      <div class="sides-container">
        {% for side in card.sides %}
        <div
          class="side-card {{ side.class }}"
          onclick="openModal({{ side.side_id or side.id }})"
        >
          <h3>{{ side.side_title }}</h3>
          <p>
            <i class="fi fi-rr-user"></i> {{ side.employee_capacity }}
            <span>/</span>
            {{ side.employees_working }} <i class="fi fi-sr-user"></i>
          </p>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">×</span>
      <div id="modal-content"></div>
    </div>
  </div>
</div>

<script>
  window.addEventListener("load", function () {
    const loader = document.querySelector(".loading-screen");
    if (loader) loader.style.display = "none";
  });
</script>
{% endblock %}
