{% extends 'base/base_dashboards.html' %} {% block title %} Ajustes {% endblock
%} {% block styles %} {# Asumiendo que los estilos de .button-4 est谩n en tu CSS
principal #}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/ajustes_styles.css') }}"
/>
{% endblock %} {% block header %}
<h1>Selecciona la l铆nea</h1>
{% endblock %} {% block content %}
<form
  class="settings-container"
  method="POST"
  action="{{ url_for('settings.configure_line_and_station') }}"
>
  <!-- Search Bar -->
  <div class="search-container">
    <input
      type="text"
      id="lineSearch"
      class="search-input"
      placeholder="Buscar l铆nea..."
      autocomplete="off"
    />
  </div>

  {% for group, lines_in_group in grouped_lines.items() %}
  <details class="group-accordion" {% if loop.first %}open{% endif %}>
    <summary class="group-summary">
      {{ group|capitalize }}
      <span class="accordion-icon"></span>
    </summary>

    {% if group|lower in ['inyecci贸n', 'metalizado'] %}
    <div class="checkbox-group">
      {% for line in lines_in_group %}
      <div class="check-group">
        <span class="label-right">
          {% if line['type_zone'] and line['type_zone']|lower != 'no definida'
          %} {{ line['type_zone']|capitalize }} {{ "AFE" if line['name']|lower
          == "afe" else line['name'] }} {% else %} {{ "AFE" if
          line['name']|lower == "afe" else line['name'] }} {% endif %}
        </span>

        <input
          type="hidden"
          name="all_positions"
          value="{{ line['position_id'] }}"
        />

        {% if line['name']|lower == 'afe' %}
        <input
          type="hidden"
          name="position_status_{{ line['position_id'] }}"
          value="on"
        />
        <input
          type="checkbox"
          id="pos_{{ line['position_id'] }}_{{ loop.index }}"
          class="toggle-input"
          checked
          disabled
        />
        <label
          for="pos_{{ line['position_id'] }}_{{ loop.index }}"
          class="label-c"
          style="cursor: not-allowed; opacity: 0.7"
          >Toggle</label
        >
        {% else %} <input type="checkbox" id="pos_{{ line['position_id'] }}_{{
        loop.index }}" class="toggle-input" name="position_status_{{
        line['position_id'] }}" {% if line['is_visible'] %}checked{% endif %}
        />
        <label
          for="pos_{{ line['position_id'] }}_{{ loop.index }}"
          class="label-c"
          >Toggle</label
        >
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div
      style="
        width: 100%;
        display: flex;
        justify-content: center;
        margin: 2rem 0;
      "
    >
      <button
        type="submit"
        name="action"
        value="save_positions"
        class="button-4"
        style="
          background-color: #6c757d;
          color: white;
          width: 50%;
          border-color: #6c757d;
        "
      >
        Guardar selecci贸n
      </button>
    </div>
    {% else %}
    <div class="settings-group-grid">
      {% for line in lines_in_group %}
      <button
        class="button-4 button-4-settings capitalize {% if line['id'] == active_line %}button-4-select{% endif %}"
        type="submit"
        name="line"
        value="{{ line['id'] }}"
      >
        {# L贸gica de visualizaci贸n del nombre #} {% if line['type_zone'] and
        line['type_zone']|lower != 'no definida' %} {{
        line['type_zone']|capitalize }} {{ "AFE" if line['name']|lower == "afe"
        else line['name'] }} {% else %} {{ "AFE" if line['name']|lower == "afe"
        else line['name'] }} {% endif %}
      </button>
      {% endfor %}
    </div>
    {% endif %}
  </details>
  {% endfor %}

  <div class="extra-actions">
    <button class="button-4" disabled>Salida general de l铆nea</button>
    <button class="button-4" disabled>Configuraci贸n de estaci贸n</button>
  </div>
</form>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("lineSearch");
    const accordions = document.querySelectorAll(".group-accordion");

    searchInput.addEventListener("input", function (e) {
      const searchTerm = e.target.value.toLowerCase().trim();

      accordions.forEach((accordion) => {
        const buttons = accordion.querySelectorAll(".button-4-settings");
        let hasVisibleButtons = false;

        buttons.forEach((btn) => {
          const text = btn.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            btn.style.display = ""; // Show
            hasVisibleButtons = true;
          } else {
            btn.style.display = "none"; // Hide
          }
        });

        // Show/Hide accordion based on matches
        if (hasVisibleButtons) {
          accordion.style.display = "";
          // Open accordion if searching
          if (searchTerm !== "") {
            accordion.open = true;
          }
        } else {
          accordion.style.display = "none";
        }
      });
    });
  });
</script>

{% endblock %}
